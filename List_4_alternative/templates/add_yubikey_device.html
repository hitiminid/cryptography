{% load static %}


<h2>Add YubiKey</h2>
<form id="u2f-form" method="post">
    {% csrf_token %}
    <input name="response" type="hidden"/>
</form>

<script src="{% static 'u2f-api.js' %}"></script>

<script type="application/json" id="django_u2f_registration">
    {{challenge|safe}}
</script>

<script>
  var registrationElem = document.getElementById('django_u2f_registration');
  if (registrationElem) {
    request = JSON.parse(registrationElem.textContent);
    u2f.register(request.appId, request.registerRequests, request.registeredKeys, function (resp) {
      var form = document.getElementById('u2f-form');
      form.response.value = JSON.stringify(resp);
      form.submit();
    });
  }
</script>